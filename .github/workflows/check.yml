name: Quality Checks

on:
  pull_request:
    branches: [master]
  push:
    branches: [master]

jobs:
  env:
    TARGET_BRANCH: master

  doxygen:
    container: khronosgroup/vulkan-samples
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: 'recursive'
    - run: mkdir -p doxygen
    - run: doxygen docs/doxygen/doxyfile
    - run: if [ $(stat -c%s doxygen/warnings.txt) -gt 0 ]; then cat doxygen/warnings.txt; exit 1; fi

  copyright_headers:
    container: khronosgroup/vulkan-samples
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: 'recursive'
    - run: python3 /usr/local/bin/check_copyright_headers.py $TARGET_BRANCH

  snake_case_check:
    container: khronosgroup/vulkan-samples
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: 'recursive'
    - run: python3 /usr/local/bin/snake_case.py $TARGET_BRANCH > snake-report.txt
    - run: if [ $(grep -c '@@' snake-report.txt) -gt 0 ]; then cat snake-report.txt; exit 1; fi

  clang_format:
    container: khronosgroup/vulkan-samples
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: 'recursive'